<!doctype html>
<html lang="en">
    <head>
		<meta charset="utf-8">

		<title>Improved Methods for Particle Tracking in CAD-Based Monte Carlo Radiation Transport</title>

		<meta name="description" content="Preliminary Defense Slides">
		<meta name="author" content="Patrick C Shriwise">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="reveal.js/css/reveal.css">
		<link rel="stylesheet" href="reveal.js/css/theme/uwmad.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

		<link rel="stylesheet" href="presentable/dist/presentable.css">

		<!-- TOC-Progress plugin -->
		<link rel="stylesheet" href="toc-progress/plugin/toc-progress/toc-progress.css">


		<!--[if lt IE 9]>
		    <script src="lib/js/html5shiv.js"></script>
		<![endif]-->
    </head>
    <body>
	<div class="reveal">
	    <div class="slides">
		<!-- Title Slide -->
		<section class="no-toc">
		    <h3 class="no-toc-progress">Improved Methods for Particle Tracking in CAD-Based Monte Carlo Radiation Transport</h3>
		    <h2>University of Wisconsin-Madison</h2>
		    <p>
			Patrick C. Shriwise
		    </p>
		    <p>
			<span id="displayDate">empty text</span>
		    </p>
		    <a href="https://beta.etherpad.org/p/shriwise_prelim_2016">https://beta.etherpad.org/p/shriwise_prelim_2016</a>
		</section>

		<!-- Table of Contents -->		
		<section class="no-toc">
		    <h3 class="no-toc-progress"> Contents </h3>
		    <nav id="presentable-toc" class="revealjs"></nav>
		</section>

		<!-- Introduction -->		
		<section>
		    
		    <section>
			<h1>Introduction</h1>
		    </section>
		    
		    <section>			
			<h2>Motivation</h2>
			<p>
			    CAD-based radition transport as a robust and practical analysis tool
			</p>
			
			<ul>
			    <li> equal freedom in deisgn and analysis </li>
			    <li> engineering analysis on the same model </li>
			</ul>
			<img src="images/cad_screenshot.png" style="border-style:none" height="450"/>
		    </section>
		    
		    <section>
			<h2>MC Geometry Representations</h2>
			<table style="border-style:black">
			    <tbody>
				<tr>
				    <th align="center">Native Geometries</th>
				    <th align="center">CAD Geometry</th>
				</tr>
				<tr>
				    <td valign="top">
					<ul>
					    <li>variants of Computational Solid Geometry (CSG)</li>
					    <li>volumes formed from boolean combinations of simple implicit surfaces</li>
					    <li>geometry queries are analytic in nature</li>
					</ul>
				    </td>
				    <td>
					<ul>
					    <li>allows for higher order surface complexity</li>
					    <li>convenient design tools</li>
					    <li>extrude, sweep, loft, splines, etc.</li>
					    <li>geometry queries are complex and sometimes impossible analytically</li>
					</ul>
				    </td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3>CAD-Based MCRT</h3>
			<ul>
			    <li>pathway for robust particle transport on CAD geometries exists</li>
			    <ul>
				<li> Direct Accelerated Geometry Mone Carlo (DAGMC<a href="#bib"><small style="vertical-align:bottom">[5]</small></a>)</li>
			    </ul>
			    <br>
			    <!-- <p style="text-align:center"><img src="images/dagmc_workflow.png" style="border-style:none" width="650"></img></p> -->
			    <li> not yet at its full potential: </li>			    
			    <ul>
				<li>difficult to meet CAD quality required for robustness in DAGMC</li>
				<li class="fragment highlight-blue">long simulation times (2.5-10<i>x</i> longer than native codes) resulting in  hours or even days of additional simulation runtime</li>
			    </ul>
			</ul>
		    </section>
		    
		    <section>
			<h3> Research Goal </h3>
			<b>CAD-based radiation transport performance competitive with native Monte Carlo geometry representations</b>
			<p>
			    <table>
				<tbody>
				    <tr>
					<td align="center"> FNG </td>
					<td align="center"> ATR </td>
					<td align="center"> UWNR </td>
				    </tr>
				    <tr>
					<td> <img src="images/FNG_cad.png" width="300" style="border-style:none;vert-align:center" /> </td>
					<td> <img src="images/ATR_cad1.png" width="300" style="border-style:none" /> </td>
					<td> <img src="images/UWNR_cad.png" width="350" style="border-style:none" /> </td>
				    </tr>
				    <tr>
					<td align="center"> neutron source </td>
					<td align="center"> kcode </td>
					<td align="center"> kcode </td>
				    </tr>
				</tbody>
			    </table>
			</p>
			<p class="fragment fade-in"> problems run with both native & CAD geometries</p>
		    </section>
		    
		    <section>
			<h3 class="no-toc-progress"> Research Goal </h3>
			<b>CAD-based radiation transport performance competitive with native Monte Carlo geometry representations</b>
			<object data="performance_plot.html" width="800px" height="500px"> </object>
		    </section>

		    <section>
			<h3> Motivation Recap </h3>
			<ul>
			    <li> CAD-Based MCRT: </li>
			    <br>
			    <ul>
				<li class="fragment">higher model fidelity</li>
				<br>
				<li class="fragment">lower human time investment in model generation </li>
				<br>
				<li class="fragment">performance comparable to native makes this more realisitc, deisrable</li>
				<br>
				<li class="fragment">new methods may be necessary for reasonable runtimes in charged particle problems</li>
			    </ul>
			</ul>
		    </section>
		    
		</section>

		<!-- Background  -->
 		<section>
		    
		    <section>
			<h1> Background </h1>
		    </section>
		    
		    <section>
			<h2>DAGMC Geometry Workflow</h2>
			<style class="text/css">
			 tr.noBorder td {border: 0;}
			 td.redBlock {text-align: center; color: white; background-color: #b70101; vertical-align: middle; }
			</style>
			<table>
			    <tbody>
				<tr class="noBorder">
				    <td></td>
				    <td style="border: 0" ></td>
				    <td style="border: 0; vertical-align:bottom" align="center"> surface faceting </td>
				    <td style="border: 0" ></td>			    
				    <td style="border-top: 2px dashed black;border-left: 2px dashed black" align="center">particle tracking</td>
				    <td style="border-top: 2px dashed black"></td>			    
				    <td align="center" style="border-right: 2px dashed black;border-top: 2px dashed black"> MCNP5 </td>
				</tr>
				<tr class="noBorder" style="height:100px">
				    <td class="redBlock" align="center"><p>CAD</p> <p>(Cubit/Trelis)</p></td>
				    <td style="vertical-align:middle" align="center"> &#8594; </td>			    
				    <td class="redBlock" align="center"><p>preprocessing</p> <p>(MOAB<a href="#bib"><small style="vertical-align:bottom;color:white">[4]</small></a>)</p></td>
				    <td style="vertical-align:middle" align="center"> &#8594; </td>			    			    
				    <td class="redBlock" align="center" style="border-left: 2px dashed black"> <p>DAGMC<a href="#bib"><small style="vertical-align:bottom;color:white">[5]</small></a></p> <p>(MOAB)</p> </td>
				    <td style="vertical-align:middle" align="center"> <p>&#8594;</p> <p>&#8592;</p> </td>			    			    
				    <td class="redBlock" align="center" style="border-right: 2px dashed black"> Monte Carlo </td>
				</tr>
				<tr class="noBorder">
				    <td align="center"> geometric design </td>
				    <td></td>
				    <td align="center"> facet sealing </td>
				    <td></td>
				    <td align="center" style="border-left: 2px dashed black;border-bottom: 2px dashed black"> ray tracing </td>
				    <td style="border-bottom: 2px dashed black"></td>
				    <td align="center" style="border-right: 2px dashed black;border-bottom: 2px dashed black"> physics </td>			      
				</tr>
				<tr>
				    <td></td>
				    <td></td>			      
				    <td align="center">
					<img class="fragment fade-in" src="images/facet_tol_zoomed.png" height="100px"/>				  
					<img class="fragment fade-in" src="images/sealing_example.png" width="300px"/>
				    </td>
				    <td></td>
				    <td align="center" colspan="3" style="vertical-align:top">
					<p>Analysis</p>
				    </td>
				</tr>
			    </tbody>
			</table>
		    </section>

		    <section>
			<h3> Surface Faceting </h3>
			<p> faceting tolerance: tolerance for farthest point on the facet from the analytic surface </p>
			<img src="images/facet_tol_zoomed.png" height="100px"/>
			<ul>
			    <li> reduce all surfaces to planar type (regardless of actual surface complexity) </li>
			    <li> many many more of them </li>
			</ul>
			<table>
			    <tbody>
				<tr>
				    <td></td>
				    <td>FNG</td>
				    <td>ATR</td>
				    <td>UWNR</td>
				    <td> ITER SDDR </td>
				</tr>
				<tr>
				    <td> Surfaces </td>
				    <td> $1 \times 10^3$ </td>
				    <td> $2.8 \times 10^3$ </td>
				    <td> $5.5 \times 10^3$ </td>
				    <td> $6.9 \times 10^3$ </td>
				</tr>
				<tr>
				    <td> Triangles </td>
				    <td> $1.2 \times 10^6$ </td>
				    <td> $4.9 \times 10^6$ </td>
				    <td> $3.3 \times 10^6$ </td>
				    <td> $43.9 \times 10^6$ </td>
				</tr>
			    </tbody>
			</table>
			<br>
			<p class="fragment">linear search of triangles is unreasonable</p>
		    </section>

		    <section>
			<h3> Ray Tracing Acceleration Data Structures </h3>
			<br>
			<p><i>field dedicated to geometric queries on surface meshses of triangles</i></p>
			<br>
			<p> employs a variety of hierarhical structures </p>
			<ul>
			    <li class="fragment"> Bounding Volume Hierarchy (BVH) </li>
			    <li class="fragment"> KDTree </li>
			    <li class="fragment"> Octree </li>
			</ul>
		    </section>
		    
		    <section>
			<h3> Bounding Volume Hierarchy </h3>
			<object data="../images/pauls_bvh.svg" class="stretch" type="image/svg+xml"></object>
		    </section>
		    
		    <section>
			<h3> KDTrees </h3>
			<ul align="left">
			    <li>same concept of hierarchy as BVH</li>
			    <li>partitions are based on planar splits </li>
			    <li>non-overlapping nodes allow for faster traversal of adjacent leaves <a href="#bib"><small style="vertical-align:bottom">[2]</small></a></li>
			</ul>
			<object data="../images/2d_kd_eg.svg" type="image/svg+xml" class="stretch"></object>
		    </section>

		    <section>
			<h3> Octrees </h3>
			<ul>
			    <li>cubic, non-overlapping bounding boxes (voxels)</li>
			    <li>hierarchy traversal just like BVH or KDTree</li>
			</ul>
			<object data="../images/octree_2d_ex.svg" type="image/svg+xml" class="stretch"></object>
			<p> (3D tree would have 8 children per node) </p>
		    </section>
		    
		    <section>
			<h3> Why BVH? </h3>
			<table>
			    <tbody>
				<td style="border: 1px solid black;vertical-align:middle">KDTree</td>
				<td style="border: 1px solid black">
				    <ul>
					<li>fastest algorithmic traversal</li>
					<li>deep trees (more memory consuption)</li>
				    </ul>
				</td>
				<tr>
				    <td style="border: 1px solid black;vertical-align:middle">Octree</td>
				    <td style="border: 1px solid black">
					<ul>
					    <li>slower traversals (typically)</li>
					    <li>data field storage</li>
					    <li>
					</ul>
				    </td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3> Bounding Boxes </h3>
			<table>
			    <tbody>
				<tr>
				    <td align="center"> Axis-Aligned </td>
				    <td align="center"> Oriented </td>
				</tr>
				<tr height="300px">
				    <td align="center"><iframe src="https://www.youtube.com/embed/w16oiYxFJJc" allowfullscreen height="300px" width="300px"></iframe></td>
				    <td align="center"><iframe src="https://www.youtube.com/embed/z_H2E3vYp_M" allowfullscreen height="300px" width="300px"></iframe></td>
				</tr>
				<tr>
				    <td align="center">
					<ul>
					    <li>low storage (6 extents)</li>
					    <li>fast, simple intersection checks</li>
					</ul>
				    </td>
				    <td align="center">
					<ul>
					    <li>higher storage (AABB+axes)</li>
					    <li>must re-orient ray for intersection checking</li>
					    <li>bound triangles well</li>
					</ul>
				    </td>
				</tr>
			    </tbody>
			</table>
		    </section>

		
		</section>

		<!-- High Valence Features -->
		<section>
		    <!-- High Valence -->
		    <section>
			<h3> High Valence Mesh Features </h3>
			<ul>
			    <li>common feature of many triangulation algorithms</li>
			    <li>result of trying to minimize triangles used to represent a surface</li>
			    <li>shown to be detrimental to DAGMC performance</li>
			</ul>
			<object align="center" data="images/hv.svg" height="400px" style="margin: 50px 50px 50px 50px" type="image/svg+xml"></object>
		    </section>
		    
		    <section>
			<h3>High Valence In Production Models</h3>
			<img src="images/hv_ex0.png" height="200px" />
			<img src="images/hv_ex1.png" height="200px" />
			<img src="images/hv_ex2.png" height="300px" />		    
		    </section>
		    
		    <section>
			<h3> High Valence Test Model </h3>
			<p align="left"> manual faceting of cube surface </p>
			<img src="../images/hv_study_design.png" height="350px"/>
			<p align="left"> variable parameters: </p>
			<ul>
			    <li> fraction of surface that high valence region occupies</li>
			    <li> valence of corner vertices </li>
			</ul>
		    </section>
		    
		    <section>
			<h3> High Valence Study </h3>
			<img src="../images/hv_study_MOAB.png" height="500px" align="center" />
		    </section>
		    
		    <section>
			<h3> High Valence OBB Investigation </h3>
			<img src="../images/obbs_wsr_0.95.png" height="500px" align="center" />
		    </section>
		    
		    <section>
			<h3> Median Splitting Algorithm </h3>
			<h4 align="center"> Controllable Parameters</h4>
			<table>
			    <tbody>
				<tr>
				    <td align="center"> Parameter </td>
				    <td align="center"> Default Value </td>
				</tr>
				<tr>
				    <td align="center"> Max Num. Leaf Entities </td>
				    <td align="center"> 8 </td>
				</tr>
				<tr>
				    <td align="center"> Max Tree Depth </td>
				    <td align="center"> 0 </td>
				</tr>
				<tr>
				    <td align="center"> Worst Split Ratio </td>
				    <td align="center"> 0.95 </td>
				</tr>
				<tr>
				    <td align="center"> Best Split Ratio </td>
				    <td align="center"> 0.0 </td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3 class="no-toc-progress"> Median Splitting Algorithm </h3>
			<pre width="1000px"><code class="hljs" data-trim>

#//attempt split on each axis
best_ratio = worst_split_ratio
for axis in axes:
    // split the box w/ a median plane along one of its axes
    left_tris, right tris = median_box_split(box, box_triangles, axis)

    // calculate the split ratio
    split_ratio = len(left_tris)-len(right_tris)/ len(box_triangles)

    // if better than the current ratio, update split
    if ( split_ratio < current_best_ratio ):
        current_best_ratio = split_ratio
        update_split(left_tris,right_tris)

//if no split better than the worst ratio is found, do nothing
			</code></pre>
			<p align="center"> solution: WSR = 1 </p>
		    </section>
		
		    <section>
			<h3> New HV Study Results </h3>
			<img src="../images/hv_study_MOAB_wsr1.png" height="500px" align="center" />
			<p class="fragment fade-in"> maintains performance without need for altered faceting </p> 
		    </section>
		    
		    <section>
			<h3> Datastructure Quality </h3>
			<blockquote>
			    <p>An often quoted statistic.. is that better than 95% of time can be spent performing this operation for complex environments.</p>
			    - Glassner, Intro to Ray Tracing
			</blockquote>
			<table>
			    <tbody>
				<tr>
				    <td style="vertical-align:top">
					<p>$ tts $ -  time to solution</p>
					<p>$ C $ -  cost of other operations </p>
					<p>$ T_{B} $ -  acceleration datastructure build time </p>
					<p>$ T_{T} $ -  traversal time </p>
					<p>$ N_{r} $ -  ray queries required for solution </p>
					<p>$ q $ -  acceleration datastructure quality </p>
				    </td>
				    <td style="vertical-align:top">$$ tts = C + T_{B} + \sum_{}^{N_{r}} T_{T} $$
					$$ tts =\,  C + T_{B} + \sum_{}^{N_{r}} T_{T}(q,\ldots) $$
				    </td>
				</tr>
			    </tbody>
			</table>
		    </section>
    
		    <section>
			<h3> Surface Area Heuristic </h3>
			<h4>(SAH)</h4>
			<p>
			  $C =  C_{t} + \frac{SA(B_{L})}{SA(B)} |P_{L}|C_{i} +  \frac{SA(B_{R})}{SA(B)} |P_{R}|C_{i}$
			    <a href="#bib"><small style="vertical-align:bottom">[2]</small></a>
			</p>
			<style class="text/css">
			 tr.noBorder td {border: 0;}
			</style>
			<table>
			    <tbody>
				<tr class="noBorder">
				    <td>$$C_{t}$$ </td><td> - cost of traversal to child nodes</td>
				</tr>
				<tr class="noBorder">
				    <td>$$C_{i} $$</td><td> - cost of primitive intersection check </td>
				</tr>
				<tr class="noBorder">
				    <td>$$SA() $$</td><td> - gives surface area of bounding volume </td>
				</tr>
				<tr class="noBorder">
				    <td>$$B_{L} $$</td><td> - bounding volume of left child </td>
				</tr>
				<tr class="noBorder">
				    <td>$$P_{L} $$</td><td> - primitives contained by the left child  </td>
				</tr>
				<tr class="noBorder">
				    <td>$$B_{R} $$</td><td> - bounding volume of right child </td>
				</tr>
				<tr class="noBorder">
				    <td>$$P_{R} $$</td><td> - primitives contained by the right child </td>
				</tr>
				<tr class="noBorder">
				    <td>$$B $$</td><td> - parent bounding volume</td>
				</tr>
			    </tbody>
			</table>
		    </section>
		
		    <section>
			<h3> SAH Applied to High Valence </h3>
			<p align="center">same tests performed using the <a href="https://embree.github.io/">Embree</a> ray tracing kernel <small style="vertical-align:bottom">[6]</small></p>
			<img src="../images/hv_emdag.png" height="500px" align="center" />		    
		    </section>

		    
		</section>
		
		<!-- SIMD BVH -->
		<section>
		    
		    <section>
			<h1> Architecture Based Acceleration </h1>
		    </section>
		    
		    <section>
			<h2 class="no-toc-progress"> Architecture Based Acceleration </h2>
			<p align="center"> Embree not just selected for building heuristic</p>
			<p align="center"> Employs Single Instruction Multiple Data (SIMD) to do multiple ray-box and ray-triangle intersection checks at once </p>
			<img src="../images/simd_ex.png" height="300px"/>
		    </section>
		    
		    <section>
			<h3> Some History </h3>
			<p> Two approaches to using SIMD in ray tracing: </p>
			<ul>
			    <li>N:1 - test many rays against a single box at once</li>
			    <li>1:N - test one ray against many boxes at once </li>
			</ul>
			<div class="fragment fade-in">
			    <p> method selection depends on <i>ray coherence</i></p>
			    <img src="../images/ray_coherence.jpg" width="500px"/>
			    <table width="500px"><tbody><tr><td align="center"> coherent</td><td align="center">incoherent</td></tr></tbody></table>
			    <small> <p>* image courtesy of <a href="https://software.intel.com/en-us/articles/embree-highly-optimized-visibility-algorithms-for-monte-carlo-ray-tracing">Intel</a></p></small>
			</div>
		    </section>
		    
		    <section>
			<h3>Quasi-Monte Carlo Ray Tracing</h3>
			<p> photo-realism (rendering based on realistic photon physics)</p>
			<style class="text/css">
			 tr.noBorder td {border: 0;}
			</style>
			<table>
			    <tbody>
				<tr class="noBorder">
				    <td align="center"> <b>N:1</b> </td>
				    <td align="center"></td>
				    <td align="center"> <b>1:N</b> </td>
				</tr>
				<tr class="noBorder">
				    <large>
					<td align="center"> (ray packets) </td>
					<td align="center"></td>
					<td align="center"> (single-ray SIMD traversal) </td>
				    </large>
				</tr>
				<tr class="noBorder fragment fade-in">
				    <td align="center"> ray coherence </td>
				    <td style="vertical-align:middle" align="center"> &#8594; </td>
				    <td align="center"> ray incoherence </td>
				</tr>			    
				<tr class="noBorder fragment fade-in">
				    <td align="center"> visualization </td>
				    <td style="vertical-align:middle" align="center"> &#8594; </td>
				    <td align="center"> physical rendering/simulation </td>
				</tr>
				<tr class="noBorder fragment fade-in">
				    <td align="center"> </td>
				    <td style="vertical-align:middle" align="center"></td>
				    <td align="center" > <font color="#b7071">MCRT</font> </td>
				</tr>
			    </tbody>
			</table>
		    </section>

		    <section>
			<h3> SIMD BVH Trees </h3>
			<p>in order to take advantage of SIMD register widths, tree topologies are altered</p>
			<img src="../images/quad_tree.png" class="stretch" />
			<p> this is accomplished by collapsing a binary tree into a quad tree </p>
		    </section>
		    
		    <section>
			<h3> Integrating Embree with DAGMC </h3>
			<p style="color:#b70101"><b> (EmDAG) </b></p>
			<img src="../images/emdag_mapping.png" align="center"/>
		    </section>
		    
		    <section>
			<h3> Ray Fire Testing Zoo </h3>
			<table style="margin: 100px 0px 0px 0px">
			    <tbody>
				<tr>
				    <td align="center"> <img src="../images/sphere.png" width="400px" /></td>
				    <td align="center"> <img src="../images/ds.png" width="400px" /></td>
				    <td align="center"> <img src="../images/larcyl.png" width="400px" /></td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3> Performance Comparison</h3>
			<table>
			    <tbody>
				<tr>
				    <td align="center"> <b>DAGMC (MOAB)</b> </td>
				    <td align="center"> <b>EmDAG (Embree)</b> </td>
				</tr>
				<tr>
				    <br>
				    <td> <object data="../images/eig_fix_rf_annotated.svg" width="500px" type="image/svg+xml" /> </td>
				    <td> <object data="../images/embree_rf_annotated.svg" width="500px"type="image/svg+xml"/> </td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3> Transport Testing </h3>
			<p align="left"> EmDAG was applied to a few simple models </p>
			<ul>
			    <li class="fragment fade-in">5 MeV isotropic neutron point source at model origin</li>
			    <li class="fragment fade-in">all volumes are water-filled (&rho; = 1 g/cc)</li>
			    <li class="fragment fade-in"> faceting tolerance: 1e-04cm </li>			
			    <li class="fragment fade-in"> 1M histories </li>
			</ul>
			<table>
			    <tbody>
				<tr>
				    <td class="noBorder fragment fade-in">
					<p align="center"> Single Sphere </p>
					<img src="../images/sphere_cad.png" width="300px" />
				    </td>								
				    <td class="noBorder fragment fade-in">
					<p align="center"> Nested Spheres </p>
					<img src="../images/nested_spheres.png" width="300px" />
				    </td>				
				    <td class="noBorder fragment fade-in">
					<p align="center"> Cube </p>
					<img src="../images/cube_cad.png" width="300px" />
				    </td>
				    <td class="noBorder fragment fade-in">
					<p align="center"> Nested Cubes </p>
					<img src="../images/nested_cubes.png" width="300px" />
				    </td>				
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3> Transport Performance </h3>
			<h4> Sphere Models </h4>
			<object data="emdag_sphere_performance.html" width="800px" height="500px"></object>
		    </section>
		    
		    <section>
			<h3 class="no-toc-progress"> Transport Performance </h3>
			<h4> Cube Models </h4>
			<object data="emdag_cube_performance.html" width="800px" height="500px"></object>
		    </section>
		    
		    <section>
			<h3>FNG Transport Results</h3>
			<ul>
			    <li class="fragment fade-in"> original source replaced with 14.1 MeV neutron isotropic volume source </li>
			    <li class="fragment fade-in"> facet tolerance: 1e-04cm</li>
			    <li class="fragment fade-in"> length tolerance: 5cm </li>
			    <li class="fragment fade-in">  100M histories</li>
			</ul>
			<img src="images/fng_cad.png" height="400px">
		    </section>
		    
		    <section>
			<h3> FNG Faceting </h3>
			<br><br>
			<table>
			    <tbody>
				<tr>
				    <td align="center"> Faceting Tolerance Only </td>
				    <td align="center">  with Length Tolerance </td>
				</tr>
				<tr>
				    <td align="center"><img src="../images/fng271_facet_tol.png" width="450px"/></td>
				    <td align="center"><img src="../images/fng271_len_tol.png" width="450px"/></td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3> FNG Transport Test </h3>
			<object data="emdag_fng_performance.html" width="800px" height="500px"></object>
			<p class="fragment"> 15% improvement in EmDAG performance w/ lentgh tolerance </p> 
		    </section>
		    
		    <section>
			<h3> EmDAG Limitations </h3>
			<ul>
			    <li> faceting tolerance: 255 lost particles </li>
			    <li> length tolerance: 247 lost particles </li>
			</ul>
			<p></p>
			<object data="../images/emdag_fng_lost.svg" type="image/svg+xml"></object>
			<p align="center "class="fragment fade-in"> caused by conversions from single to double precision and vice versa </p>
		    </section>

		</section>

		<!-- Implicit Surfaces -->
		<section>
		    
		    <section>
			<h2>Implicit Surfaces and Signed Distance Fields </h2>
		    </section>
		    
		    <section>
			<h3> Implicit Surfaces </h3>
			<h4> (& Level-Set Methods) </h4>
			<p align="center"> An implicit surface is a multivariate function defined over an $ R^3 $ domain</p>
			$$    \Omega(R^3)\rightarrow R $$
			<p align="center"> where points on the surface are represented by the isocontour $v=0$ </p>
			$$   \Omega(\vec{x}) - v  = 0 $$
			<p align="center"> important geometric properties can be easily recovered from this represntation </p>
			<table>
			    <tbody>
				<tr class="noBorder">
				    <td align="center" class="fragment">
					<p align="center"> Surface Normal </p>
					$$<\Omega_{x}(\vec{x}),\Omega_{y}(\vec{y}),\Omega_{z}(\vec{z})>$$
				    </td>
				    <td align="center" class="fragment">
					<p> Distance to Nearest Intersection </p>
					$$ |\Omega(\vec{x})| $$
				    </td>
				    <td align="center" class="fragment">
					<p align="center"> Interior vs. Exterior Locations </p>
					$$ sign(\Omega(\vec{x}))$$
				    </td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3 class="no-toc-progress"> Implicit Surfaces </h3>
			<p align="left"> used for:
			    <ul>
				<li> modeling (CSG), simulation, triangulation </li>
				<li class="fragment"> and rendering of dynamic surfaces like smoke or fire ($\Omega(\vec{x},t)$) </li>
			    </ul>
			    <p align="left" class="fragment"> ray marching: </p>
			<p class="fragment current-visible"><object data="../images/rm0.svg" style="margin: -50px -80px 0px 0px" height="500px" type="image/svg+xml"></object></p>
			<p class="fragment current-visible"><object data="../images/rm1.svg" style="margin: -50px -80px 0px 0px" height="500px" type="image/svg+xml"></object></p>
		    </section>
		    
		    <section>
			<h3> Signed Distance Fields </h3>
			<p align="left"> ray marching is accomplished using sampled fields with these requirements </p>
			<small>
			    <ul>
				<li> $ d(\vec{x}) = 0 $ for all $x$ on the surface boundary </li>
				<li> $ d(\vec{x}) < 0 $ for all $x$ inside the surface boundary </li>
				<li> $ d(\vec{x}) > 0  $ for all $x$ outside the surface boundary </li>
			    </ul>
			    <p align="center"> $ d(\vec{x}) = sign(\Omega(\vec{x}))|\Omega(\vec{x})| $ </p>
			</small>
			<object data="../images/preconditioner_datastruct.svg" type="image/svg+xml" height="400px"></object>
		    </section>
		    
		    <section>
			<h3> Particle Tracking Preconditioner </h3>
			<ul>
			    <li> use interpolated signed distance values to rule out surface crossing </li>
			    <li> avoids O(log(N)) in favor of O(1) process </li>
			    <li> best for particles traveling far from surfaces </li>
			    <li> sign-based point containment queries </li>
			</ul>
			<object data="../images/preconditioner_ex.svg" type="image/svg+xml" class="stretch"></object>
		    </section>
		    
		    <section>
			<h3> Interpolation Error Estimate </h3>
			<h4> (a 2D example) </h4>
			<p align="center"> $$ \epsilon = \frac{1}{2} \Delta x (h-\Delta x) \frac{\partial^2 u}{\partial x^2} + \frac{1}{2} \Delta y (h-\Delta y)  \frac{\partial^2 u}{\partial y^2} $$ </p>
			<table>
			    <tbody>
				<tr class="noBorder"><td>$$ h $$</td><td> - mesh interval size </td></tr>
				<tr class="noBorder"><td>$$ \Delta x $$</td><td> - x distance to interpolation point from data point </td></tr>
				<tr class="noBorder"><td>$$ \Delta y $$ </td> <td> - y distance to interpolation point from data point </td></tr>
				<tr class="noBorder"><td>$$ u(x,y) $$</td><td>- sampled function on mesh </td></tr>
				<tr class="noBorder"><td>$$ \epsilon $$</td><td>- interpolation error </td></tr>
			    </tbody>
			</table>
			<p align="center" class="fragment"> <i>curvature terms are problematic</i> </p>
		    </section>
		    
		    <section>
			<h3> Initial Implementation </h3>
			<ul>
			    <li>uses MOAB's structured mesh interface</li>
			    <li>populated using MOAB's ray tracing interface (closest to location alg.)</li>
			    <ul>
				<li>disambiguates distance value signs using DAGMC's point containment algorithm</li>
			    </ul>
			</ul>
			<img src="../images/sdf_sphere.png" height="550x"/>
		    </section>
		    
		    <section>
			<h3> Preconditioner Test </h3>
			<ul>
			    <li>5 MeV isotropic neutron point source at model origin</li>
			    <li>single volume: 10 cm radius sphere</li>
			    <li>all volumes are water-filled </li>
			    <li>density varied from 0 to 1 (g/cc) </li>
			    <li>faceting tolerance: 1e-04cm </li>			
			    <li>1M histories </li>
			</ul>
			<img src="../images/sphere_cad.png" height="400px" align="center" />
				    </section>
		    
		    <section id="precond_sphere_water">
			<h3> Initial Results </h3>
			
			<object data="precond_sphere_water.html" class="stretch"></object>
		    </section>

		    <section>
			<h3> Initial Results </h3>
			<object data="precond_rays_fired.html" class="stretch"></object>
		    </section>
		    
		    <section>
			<h3> Initial Results </h3>
			<p align="center">$$ U = \frac{dagmc\, rays -  dagmc\, w/\, precond.\, rays}{dagmc\, rays}$$ </p>
			<object data="precond_utilization.html" class="stretch"></object>
		    </section>
		    
		</section>

		<!-- Research Proposal -->
		<section>

		    <section>
			<h2> Proposed Work </h2>
		    </section>
		    
		    <section>
			<h3> Feature Adaptation in BVH Construction </h3>
			<ul>
			    <li>alter building parameters for problematic mesh regions which can be identified by poorly formed tree topology</li>
			    <li>of particular interest is the high valence case</li>
			</ul>
			<p align="center"> this process is likely of more interest to radiation transport than rendering </p>
			<table>
			    <tbody>
				<tr>
				    <td align="center" colspan="2"> <b>Primary Ray Estimates</b> </td>
				</tr>
				<tr>
				    <td style="border-right: 1px solid black"> rendering </td>
				    <td align="right" width="800px"> $ (\sim 8 \frac{rays}{pixel})(1024 \times 1080\, pixels) $ = $16.6 \times 10^6$ rays</td>
				</tr>
				<tr style="border-bottom: 1px solid black">
				    <td style="border-right: 1px solid black"> radiation transport </td>
				    <td style="vertical-align:middle" align="right"> $ 1 \times 10^9 $ histories $ $ = $ 1 \times 10^9 $ rays </td>
				</tr>
			    </tbody>
			</table>
			<p align="center" class="fragment"> additional order-of-magnitude in secondary rays for radiation transport as well</p>
				    </section>
		    
		    <section>
			<h3 class="no-toc-progress"> Feature Adaptation in BVH Construction </h3>
			<table>
			    <tbody>
				<tr>
				    <td>
					<p>$ tts $ -  time to solution</p>
					<p>$ C $ -  cost of other operations </p>
					<p>$ T_{B} $ -  acceleration datastructure build time </p>
					<p>$ T_{T} $ -  average traversal time </p>
					<p>$ N_{r} $ -  ray queries  required for solution </p>
					<p>$ q $ -  acceleration datastructure quality </p>
				    </td>
				    <td>$$ tts = C + T_{B} + \sum_{}^{N_{r}} T_{T} $$
					$$ tts =\,  C + T_{B} + \sum_{}^{N_{r}} T_{T}(q,\ldots) $$
					$$ q(T_{B})  \rightarrow T_{T}(T_{B}) \rightarrow T_{T} \propto \frac{1}{{T_{B}}^{x}} \,\, (\, x \geq 0) $$
					$$ tts =\,  C + T_{B} + \sum_{}^{N_{r}} T_{T}(T_{B},\ldots) $$
				    </td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3 class="no-toc-progress"> Feature Adaptation in BVH Construction </h3>
			<h4> Objectives </h4>
			<ul>
			    <li> create a generalized building scheme for poorly formed tree nodes involving two steps</li>
			    <ul>
				<li> feature detection </li>
				<li> feature adaptation </li>
				<li> can similar solution be applied to SAH building or is the modified median splitting build necessary?</li>
			    </ul>
			    <li> ideally this can be applied to other problematic mesh features as well </li>
			    <li> apply to test model and other production models known to contain high valence regions to examine improvement </li>
			</ul>
		    </section>
		    
		    <section>
			<h3> Architecture Based Acceleration </h3>
			<p> the Embree kernel does not meet the requirments of the robust tracking algorithm used by DAGMC as it currently exists </p>
			<ul>
			    <li class="fragment"> single to double precision conversion </li>
			    <li class="fragment"> logic involving mesh interrogation </li>
			</ul>
			<br></br>
			<br></br>
			<table class="fragment">
			    <tbody>
				<tr>
				    <td align="center"><b>MOAB</b></td>
				    <td align="center"><b>EmDAG</b></td>
				</tr>
				<tr>
				    <td width="300px">
					<ul>
					    <li>designed for interrogation/manipulation of mesh</li>
					    <li>slow due to database context</li>
					</ul>
				    </td>
				    <td width="300px">
					<ul>
					    <li>very fast CPU-based ray tracing</li>
					    <li>single-precision</li>
					    <li>limited mesh interface</li>
					</ul>
				    </td>
				</tr>
			    </tbody>
			</table>
		    </section>
		    
		    <section>
			<h3 class="no-toc-progress"> Architecture Based Acceleration </h3>
			<h4> Going Forward </h4>
			<ul>
			    <li class="fragment highlight-red">separate DAGMC tracking code from MOAB's ray tracing interface</li>
			    <ul>
				<div class="fragment">
				    <li>determine what is critical; what is necessary; what requires MOAB</li>
				</div>
			    </ul>
			    <br>
			    <li class="fragment highlight-red"> couple SIMD BVH traversal to a MOAB-build hierarchy </li>
			    <ul>
				<div class="fragment">
				    <li>MOAB provides contiguous memory sets via its direct access methods</li>
				    <ul>
					<li>no primitive  memory duplication</li>
					<li>contiguous memory for primitives, hierarchy</li>
				    </ul>
				</div>
			    </ul>
			    <br>
			    <li class="fragment highlight-red">proposed implementation </li>
			    <ul>
				<div class="fragment">
				    <li>single-precision boxes constructed around MOAB's double-precision primitives</li>
				    <li> perform SIMD traversal of n-ary tree </li>
				    <li> double precision intersection of triangles</li>
				    <li>will maintain much of Embree's speed as majority of time is spent in BVH traversal</li>
				</div>
			    </ul>
			</ul>
				    </section>
		    
		    <section>
			<h3 class="no-toc-progress"> Architecture Based Acceleration </h3>
			<h4> Contributions </h4>
			<ul>
			    <li class="fragment"> mixed-precision SIMD BVH traversal on common CPU architectures </li>
			    <br>
			    <li class="fragment"> provides high-performance spatial searches coupled with mesh database designed for engineering analysis </li>
			    <br>
			    <li class="fragment"> allows DAGMC particle tracking logic to be coupled to high-performance CPU ray tracer w/ double precision </li>
			    <br>
			    <li class="fragment"> significantly improves performance of radiation transport on CAD models </li>
			</ul>
		    </section>
		    
		    <section>
			<h3> Signed Distance Field Preconditioner </h3>
			<ul>
			    <li class="fragment"> has already been shown to be a powerful acceleration tool given the <a href="#precond_sphere_water">proper conditions</a>  </li>
			    <br>
			    <li class="fragment"> identification of proper conditions for this datastructure is important</li>
			    <br>
			    <li class="fragment"> memory footprint is of concern </li>
			    <ul class="fragment">
				<li> adaptive mesh refinement or octree may be useful </li>
				<li> error estimation becomes more difficult with non-uniform techniques </li>
				<li> other uniform mesh methods could be helpful <cite><small style="vertical-align:bottom">Setaulri_2014</small></cite> </li>
			    </ul>
			</ul>
		    </section>

		    <section>
			<h3> Summary </h3>
			<p> each approach aides in goal of CAD-Based Monte Carlo Radiation Transport performance on the order of analytic/native/CSG geometry representations</p>
			<ul>
			    <li class="fragment"> trees should now be optimized for high valence regions </li>
			    <li class="fragment"> ray tracing greatly increases single-node efficiency </li>
			    <li class="fragment"> preconditioner will help to reduce overall order of particle tracking compelxity if utilized well</li>
			    <li class="fragment"> increased ray tracing performance assists other MOAB and DAGMC based applications as well </li>
			</ul>
			<p class="fragment"><b>final combined effect is a more effective CB-MCRT pathway for analysis</b></p>
		    </section>

		    <section id="bib">
			<h3> References </h3>
			<small>
			    <div class="references">
				<p>[1] Hapala, M., and V. Havran. 2011. “Review: Kd-Tree Traversal Algorithms for Ray Tracing.” <em>Computer Graphics Forum</em> 30 (1): 199–213. <a href="http://search.ebscohost.com.ezproxy.library.wisc.edu/login.aspx?direct=true&amp;AuthType=ip,uid&amp;db=aph&amp;AN=58613009&amp;site=ehost-live&amp;scope=site" class="uri">http://search.ebscohost.com.ezproxy.library.wisc.edu/login.aspx?direct=true&amp;AuthType=ip,uid&amp;db=aph&amp;AN=58613009&amp;site=ehost-live&amp;scope=site</a>.</p>
				<p>[2] MacDonald, Kellogg S., J. David ; Booth. 1990. “Heuristics for Ray Tracing Using Space Subdivision.” <em>The Visual Computer</em> 6 (3): 153–66. doi:<a href="http://dx.doi.org/10.1007/BF01911006">10.1007/BF01911006</a>.</p>
				<p>[3] Setaluri, Rajsekhar, Mridul Aanjaneya, Sean Bauer, and Eftychios Sifakis. 2014. “SPGrid: A Sparse Paged Grid Structure Applied to Adaptive Smoke Simulation.” <em>ACM Trans. Graph.</em> 33 (6). New York, NY, USA: ACM: 205:1–205:12. doi:<a href="http://dx.doi.org/10.1145/2661229.2661269">10.1145/2661229.2661269</a>.</p>
				<p>[4] Tautges, T. J., R. Meyers, K. Merkley, C. Stimpson, and C. Ernst. 2004. <em>MOAB: A Mesh-Oriented Database</em>. SAND2004-1592. Sandia National Laboratories.</p>
				<p>[5] Tautges, Timothy J., P. P. H. Wilson, Jason Kraftcheck, Brandon M. Smith, and Douglass L. Henderson. 2009. “Acceleration Techniques for Direct Use of CAD-Based Geometries in Monte Carlo Radiation Transport.” In <em>International Conference on Mathematics, Computational Methods &amp; Reactor Physics (M&amp;C 2009)</em>. Saratoga Springs, NY: American Nuclear Society.</p>
				<p>[6] Wald, Ingo, Sven Woop, Carsten Benthin, Gregory S. Johnson, and Manfred Ernst. 2014. “Embree: A Kernel Framework for Efficient CPU Ray Tracing.” <em>ACM Trans. Graph.</em> 33 (4). New York, NY, USA: ACM: 143:1–:8. doi:<a href="http://dx.doi.org/10.1145/2601097.2601199">10.1145/2601097.2601199</a>.</p>
				<p>[7] X-5 Monte Carlo Team. 2004. <em>MCNP - a General Monte Carlo N-Particle Transport Code, Version 5 - Volume III: Developers Guide</em>. LA-CP-03-0284. Los Alamos National Laboratory.</p>
			    </div>
			</small>
		    </section>
		    
	    </div>
	</div>
                <!-- SCRIPTS -->
		<script src="reveal.js/lib/js/head.min.js"></script>
		<script src="reveal.js/js/reveal.js"></script>
		<script>
		     Reveal.initialize({
			 controls: true,
			 progress: true,
			 history: true,
			 center: false,
		     slideNumber: true,
		     
			 transition: 'none', // none/fade/slide/convex/concave/zoom
			 // More info https://github.com/hakimel/reveal.js#dependencies
			 dependencies: [
			     { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
			     { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
			     { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
			     { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
			     { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
			     { src: 'reveal.js/plugin/notes/notes.js', async: true },
			     { src: 'reveal.js/plugin/math/math.js', async: true },
			     { src: 'presentable/dist/presentable.js', callback: function() { presentable.toc({framework: "revealjs"}); } },
			     { src: 'toc-progress/plugin/toc-progress/toc-progress.js', async: true, callback: function() { toc_progress.initialize(); toc_progress.create(); } }
			 ]
		     });
		 Reveal.configure( {slideNumber: 'c'});
		</script>
		<script type="text/javascript">
		 var newDate = new Date();
		 newDate.setDate(newDate.getDate());
		 document.getElementById('displayDate').innerHTML = (newDate.getMonth() + 1) + '/' + newDate.getDate() + '/' + newDate.getFullYear();
		</script>

				<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : '/reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		

    </body>
</html>
